<pre><font color="#5a5a5a">; Gas Consumption Simulation for a City</font><font color="#000000"><br /></font><font color="#5a5a5a">; Variables and setup</font><font color="#000000"><br /></font><font color="#007f69">globals</font><font color="#000000"> [<br />  month<br />  year<br />  current-month-name<br />  season-factor<br />  incident-occurred?<br />  initial-population<br />  base-consumption<br />  growth-rate<br />  high-season-factor<br />  low-season-factor<br />  incident-probability<br />  random-variation<br />  minimum-consumption<br />]<br /><br /></font><font color="#5a5a5a">; Create a breed for people who consume gas</font><font color="#000000"><br /></font><font color="#660096">breed</font><font color="#000000"> [residents resident]<br /><br /></font><font color="#007f69">residents-own</font><font color="#000000"> [<br />  consumption </font><font color="#5a5a5a">; individual monthly gas consumption</font><font color="#000000"><br />]<br /><br /></font><font color="#007f69">to</font><font color="#000000"> setup<br />  </font><font color="#0000aa">clear-all</font><font color="#000000"><br />  </font><font color="#0000aa">reset-ticks</font><font color="#000000"><br />  <br />  </font><font color="#5a5a5a">; Initialize parameters</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> initial-population </font><font color="#963700">1000</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> base-consumption </font><font color="#963700">450</font><font color="#000000">      </font><font color="#5a5a5a">; Base consumption per resident</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> growth-rate </font><font color="#963700">0.0003</font><font color="#000000">        </font><font color="#5a5a5a">; 0.03% annual growth rate as a decimal</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> high-season-factor </font><font color="#963700">1.2</font><font color="#000000">    </font><font color="#5a5a5a">; 20% increase in winter</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> low-season-factor </font><font color="#963700">0.8</font><font color="#000000">     </font><font color="#5a5a5a">; 20% decrease in summer</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> incident-probability </font><font color="#963700">0.1</font><font color="#000000">  </font><font color="#5a5a5a">; 10% chance of an incident each month</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> random-variation </font><font color="#963700">20</font><font color="#000000">       </font><font color="#5a5a5a">; Random variation in consumption</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> minimum-consumption </font><font color="#963700">400</font><font color="#000000">   </font><font color="#5a5a5a">; Minimum consumption never goes below 400 units</font><font color="#000000"><br />  <br />  </font><font color="#5a5a5a">; Initialize time variables</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> month </font><font color="#963700">1</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> year </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> current-month-name </font><font color="#963700">&quot;January&quot;</font><font color="#000000"><br />  <br />  </font><font color="#5a5a5a">; Create initial population</font><font color="#000000"><br />  create-residents initial-population [<br />    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;person&quot;</font><font color="#000000"><br />    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">blue</font><font color="#000000"><br />    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">1.5</font><font color="#000000"><br />    </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">random-xcor</font><font color="#000000"> </font><font color="#660096">random-ycor</font><font color="#000000"><br />    </font><font color="#0000aa">set</font><font color="#000000"> consumption base-consumption </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">10</font><font color="#000000"> </font><font color="#5a5a5a">; some variation in base consumption</font><font color="#000000"><br />  ]<br />  <br />  </font><font color="#5a5a5a">; Initialize plots</font><font color="#000000"><br />  do-plots<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> go<br />  </font><font color="#0000aa">if</font><font color="#000000"> year </font><font color="#660096">&gt;=</font><font color="#000000"> </font><font color="#963700">10</font><font color="#000000"> [ </font><font color="#0000aa">stop</font><font color="#000000"> ] </font><font color="#5a5a5a">; Run for 10 years</font><font color="#000000"><br />  <br />  </font><font color="#5a5a5a">; Update season factor based on month</font><font color="#000000"><br />  set-season-factor<br />  <br />  </font><font color="#5a5a5a">; Check for random incidents</font><font color="#000000"><br />  check-for-incidents<br />  <br />  </font><font color="#5a5a5a">; Update consumption for all residents</font><font color="#000000"><br />  </font><font color="#0000aa">ask</font><font color="#000000"> residents [<br />    update-consumption<br />  ]<br />  <br />  </font><font color="#5a5a5a">; Grow population (monthly growth rate = annual growth rate / 12)</font><font color="#000000"><br />  grow-population<br />  <br />  </font><font color="#5a5a5a">; Update time</font><font color="#000000"><br />  update-time<br />  <br />  </font><font color="#5a5a5a">; Update plots</font><font color="#000000"><br />  do-plots<br />  <br />  </font><font color="#0000aa">tick</font><font color="#000000"><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> set-season-factor<br />  </font><font color="#5a5a5a">; Set seasonal factors based on month (northern hemisphere pattern)</font><font color="#000000"><br />  </font><font color="#5a5a5a">; Winter (high consumption): Dec, Jan, Feb</font><font color="#000000"><br />  </font><font color="#5a5a5a">; Spring (medium consumption): Mar, Apr, May</font><font color="#000000"><br />  </font><font color="#5a5a5a">; Summer (low consumption): Jun, Jul, Aug</font><font color="#000000"><br />  </font><font color="#5a5a5a">; Fall (medium consumption): Sep, Oct, Nov</font><font color="#000000"><br />  <br />  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">member?</font><font color="#000000"> month [</font><font color="#963700">12</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">] [<br />    </font><font color="#0000aa">set</font><font color="#000000"> season-factor high-season-factor </font><font color="#5a5a5a">; Winter - high consumption</font><font color="#000000"><br />  ]<br />  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">member?</font><font color="#000000"> month [</font><font color="#963700">3</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000">] [<br />    </font><font color="#0000aa">set</font><font color="#000000"> season-factor </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> (high-season-factor </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> (month </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000">) </font><font color="#5a5a5a">; Spring - transitioning down</font><font color="#000000"><br />  ]<br />  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">member?</font><font color="#000000"> month [</font><font color="#963700">6</font><font color="#000000"> </font><font color="#963700">7</font><font color="#000000"> </font><font color="#963700">8</font><font color="#000000">] [<br />    </font><font color="#0000aa">set</font><font color="#000000"> season-factor low-season-factor </font><font color="#5a5a5a">; Summer - low consumption</font><font color="#000000"><br />  ]<br />  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">member?</font><font color="#000000"> month [</font><font color="#963700">9</font><font color="#000000"> </font><font color="#963700">10</font><font color="#000000"> </font><font color="#963700">11</font><font color="#000000">] [<br />    </font><font color="#0000aa">set</font><font color="#000000"> season-factor low-season-factor </font><font color="#660096">+</font><font color="#000000"> (high-season-factor </font><font color="#660096">-</font><font color="#000000"> low-season-factor) </font><font color="#660096">*</font><font color="#000000"> ((month </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">8</font><font color="#000000">) </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000">) </font><font color="#5a5a5a">; Fall - transitioning up</font><font color="#000000"><br />  ]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> check-for-incidents<br />  </font><font color="#5a5a5a">; Random incidents that affect consumption</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> incident-occurred? </font><font color="#963700">false</font><font color="#000000"><br />  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> incident-probability [<br />    </font><font color="#0000aa">set</font><font color="#000000"> incident-occurred? </font><font color="#963700">true</font><font color="#000000"><br />  ]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> update-consumption<br />  </font><font color="#5a5a5a">; Calculate new consumption based on base level, season, and possible incidents</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> new-consumption base-consumption </font><font color="#660096">*</font><font color="#000000"> season-factor<br />  <br />  </font><font color="#5a5a5a">; Add random variation</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> new-consumption new-consumption </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-float</font><font color="#000000"> random-variation </font><font color="#660096">-</font><font color="#000000"> (random-variation </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)<br />  <br />  </font><font color="#5a5a5a">; Apply incident effect if an incident occurred</font><font color="#000000"><br />  </font><font color="#0000aa">if</font><font color="#000000"> incident-occurred? [<br />    </font><font color="#0000aa">set</font><font color="#000000"> new-consumption new-consumption </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">11</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000">) </font><font color="#5a5a5a">; -5 to +5 units change</font><font color="#000000"><br />  ]<br />  <br />  </font><font color="#5a5a5a">; Ensure consumption never goes below minimum</font><font color="#000000"><br />  </font><font color="#0000aa">if</font><font color="#000000"> new-consumption </font><font color="#660096">&lt;</font><font color="#000000"> minimum-consumption [<br />    </font><font color="#0000aa">set</font><font color="#000000"> new-consumption minimum-consumption<br />  ]<br />  <br />  </font><font color="#5a5a5a">; Update resident's consumption</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> consumption new-consumption<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> grow-population<br />  </font><font color="#5a5a5a">; More accurate implementation of 0.03% monthly growth</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> current-population </font><font color="#660096">count</font><font color="#000000"> residents<br />  </font><font color="#0000aa">let</font><font color="#000000"> monthly-growth-rate growth-rate </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">12</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> expected-new-residents current-population </font><font color="#660096">*</font><font color="#000000"> monthly-growth-rate<br />  <br />  </font><font color="#5a5a5a">; Handle fractional growth with probability</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> whole-new-residents </font><font color="#660096">floor</font><font color="#000000"> expected-new-residents<br />  </font><font color="#0000aa">let</font><font color="#000000"> fractional-part expected-new-residents </font><font color="#660096">-</font><font color="#000000"> whole-new-residents<br />  <br />  </font><font color="#5a5a5a">; Add the whole number part</font><font color="#000000"><br />  </font><font color="#0000aa">if</font><font color="#000000"> whole-new-residents </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [<br />    create-residents whole-new-residents [<br />      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;person&quot;</font><font color="#000000"><br />      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">blue</font><font color="#000000"><br />      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">1.5</font><font color="#000000"><br />      </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">random-xcor</font><font color="#000000"> </font><font color="#660096">random-ycor</font><font color="#000000"><br />      </font><font color="#0000aa">set</font><font color="#000000"> consumption base-consumption </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">10</font><font color="#000000"> </font><font color="#5a5a5a">; some variation in base consumption</font><font color="#000000"><br />    ]<br />  ]<br />  <br />  </font><font color="#5a5a5a">; Handle fractional part probabilistically</font><font color="#000000"><br />  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> fractional-part [<br />    create-residents </font><font color="#963700">1</font><font color="#000000"> [<br />      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;person&quot;</font><font color="#000000"><br />      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">blue</font><font color="#000000"><br />      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> </font><font color="#963700">1.5</font><font color="#000000"><br />      </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">random-xcor</font><font color="#000000"> </font><font color="#660096">random-ycor</font><font color="#000000"><br />      </font><font color="#0000aa">set</font><font color="#000000"> consumption base-consumption </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">10</font><font color="#000000"><br />    ]<br />  ]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> update-time<br />  </font><font color="#5a5a5a">; Increment month and year</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> month month </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"><br />  </font><font color="#0000aa">if</font><font color="#000000"> month </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">12</font><font color="#000000"> [<br />    </font><font color="#0000aa">set</font><font color="#000000"> month </font><font color="#963700">1</font><font color="#000000"><br />    </font><font color="#0000aa">set</font><font color="#000000"> year year </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"><br />  ]<br />  <br />  </font><font color="#5a5a5a">; Set current month name</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> current-month-name </font><font color="#660096">item</font><font color="#000000"> (month </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [</font><font color="#963700">&quot;January&quot;</font><font color="#000000"> </font><font color="#963700">&quot;February&quot;</font><font color="#000000"> </font><font color="#963700">&quot;March&quot;</font><font color="#000000"> </font><font color="#963700">&quot;April&quot;</font><font color="#000000"> </font><font color="#963700">&quot;May&quot;</font><font color="#000000"> </font><font color="#963700">&quot;June&quot;</font><font color="#000000"> </font><font color="#963700">&quot;July&quot;</font><font color="#000000"> </font><font color="#963700">&quot;August&quot;</font><font color="#000000"> </font><font color="#963700">&quot;September&quot;</font><font color="#000000"> </font><font color="#963700">&quot;October&quot;</font><font color="#000000"> </font><font color="#963700">&quot;November&quot;</font><font color="#000000"> </font><font color="#963700">&quot;December&quot;</font><font color="#000000">]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> do-plots<br />  </font><font color="#5a5a5a">; Update the plots</font><font color="#000000"><br />  </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Total Gas Consumption&quot;</font><font color="#000000"><br />  </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;total&quot;</font><font color="#000000"><br />  </font><font color="#0000aa">plot</font><font color="#000000"> </font><font color="#660096">sum</font><font color="#000000"> [consumption] </font><font color="#660096">of</font><font color="#000000"> residents<br />  <br />  </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Population&quot;</font><font color="#000000"><br />  </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;people&quot;</font><font color="#000000"><br />  </font><font color="#0000aa">plot</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> residents<br />  <br />  </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Average Consumption Per Resident&quot;</font><font color="#000000"><br />  </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;average&quot;</font><font color="#000000"><br />  </font><font color="#0000aa">plot</font><font color="#000000"> </font><font color="#660096">mean</font><font color="#000000"> [consumption] </font><font color="#660096">of</font><font color="#000000"> residents<br />  <br />  </font><font color="#0000aa">set-current-plot</font><font color="#000000"> </font><font color="#963700">&quot;Monthly Consumption Over Time&quot;</font><font color="#000000"><br />  </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;consumption&quot;</font><font color="#000000"><br />  </font><font color="#0000aa">plot</font><font color="#000000"> </font><font color="#660096">sum</font><font color="#000000"> [consumption] </font><font color="#660096">of</font><font color="#000000"> residents<br /></font><font color="#007f69">end</font>
</pre>
